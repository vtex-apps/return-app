# Return App

#### Short description
The return application serves the necessary functionalities for requesting returns from customers, and their processing by the administrators of the online store.

#### Installation and configuration

The application can be installed using the following command in VTEX Toolbelt: `vtex install vtex.return-app@0.x`

After the installation you must access the `Returns > Requests` page from the admin menu. At this point, the application creates the masterdata schema and email templates automatically.
-	The email templates are generated by sending a POST request to `/api/template-render/pvt/templates`
-	The masterdata schema are generated using the `clients.masterdata.createOrUpdateSchema` method from the `Context`

There are 5 schemas in masterdata:

| Schema name       | Fields            | Type field      |
| --------------- | --------------- | ---------------- |
| `returnSettings` | `maxDays`<br>`excludedCategories`<br>`termsUrl`<br>`type` | `settings` |
| `returnRequests` | `userId`<br>`orderId`<br>`name`<br>`email`<br>`phoneNumber`<br>`country`<br>`locality`<br>`address`<br>`totalPrice`<br>`paymentMethod`<br>`voucherCode`<br>`refundedAmount`<br>`iban`<br>`status`<br>`dateSubmitted`<br>`type` | `request` |
| `returnProducts` | `refundId`<br>`orderId`<br>`userId`<br>`imageUrl`<br>`skuId`<br>`skuName`<br>`unitPrice`<br>`quantity`<br>`totalPrice`<br>`goodProducts`<br>`status`<br>`dateSubmitted`<br>`type` | `product` |
| `returnComments` | `refundId`<br>`status`<br>`comment`<br>`visibleForCustomer`<br>`submittedBy`<br>`dateSubmitted`<br>`type` | `comment` |
| `returnStatusHistory` | `refundId`<br>`status`<br>`submittedBy`<br>`dateSubmitted`<br>`type` | `statusHistory` |

After this step the administrators will go to `Returns > Settings` page and fill up the form with the settings they want.

### Routes: 

The application use 6 routes. 3 routes for admins and 3 for customers

#### Admin routes:
-	`Returns > Settings` (the page where administrators configure application settings)
-	`Returns > Requests` (here the return requests will be displayed in a table)
-	`Returns > Requests > Details` (on this page the details of the return request are displayed, the status of the request can be modified and comments can be added for each status)

#### Customer routes:
-	`My returns` (on this page the customer can see all his return requests)
-	`My returns > Add` (from this page the customer adds a new return request)
-	`My returns > Details` (on this page the customer can see all the information about the return request. This page is very similar to the admin page, except that the customer does not have access to change the status of the return request or change the status of the products)


## Return requests information


#### Available payment methods

| Payment method       | Description   |
| --------------- | --------------- |
| `Credit or debit card` | This option is only available if the customer has paid with the card | 
| `Bank transfer` | For this option the IBAN input will be available for customer. This field is required and has a specific validation |
| `Voucher` | If the customer choose this option, a coupon will be generated automatically when the request reach the `Amount refunded` status |

#### Request statuses

| Status       | Description   | Next status      |
| --------------- | --------------- | ---------------- |
| `New` | This is the default status for a return request | `Picked up from client` |
| `Picked up from client` | The request reaches this state when the administrators receive the package from the client | `Pending verification` |
| `Pending verification` | In this state, administrators check the products returned by the customer. The "Verify package" button will be available on the return details page, above the product table. | `Approved`<br><br>`Partially approved`<br><br>`Denied` |
| `Approved` | The return request reaches this state if all products are in good condition. | `Amount refunded` |
| `Partially approved` | The return request reaches this state if the number of products in good condition is less than the total number of products in the return request. | `Amount refunded` |
| `Denied` | The return request reaches this state if there are no products in good condition | `-` |
| `Amount refunded` | This is the last state for a return request, if it has not been denied. The administrators will move the request in this state after making the payment to the client (by card or by bank transfer). If the customer requested the return of the money by voucher, the voucher will be generated automatically when the request reach this state. | `-` |
